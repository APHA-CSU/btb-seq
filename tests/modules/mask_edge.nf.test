nextflow_process {

    name "Test Process mask"
    script "main.nf"
    process "MASK"

    test("Should produce a combined mask in bed format") {

        when {
            params {
                rptmask = "${projectDir}/tests/data/edge-cases.bed"
                allsites = "${projectDir}/tests/data/edge-cases_regions.bed"
                MIN_READ_DEPTH = 8
                MIN_ALLELE_FREQUENCY_ALT = 0.8
                MIN_ALLELE_FREQUENCY_REF = 0.7
            }
            process {
                """
                input[0] = ["edge-cases", file("${projectDir}/tests/data/edge-cases.vcf.gz"), 
                            file("${projectDir}/tests/data/edge-cases.vcf.gz.csi"), 
                            file("${projectDir}/tests/data/edge-cases.sam")] 
                input[1] = params.rptmask
                input[2] = params.allsites
                input[3] = params.MIN_READ_DEPTH
                input[4] = params.MIN_ALLELE_FREQUENCY_ALT
                input[5] = params.MIN_ALLELE_FREQUENCY_REF
                """
            }
        }

        then {
            assert process.success
            assert snapshot(process.out).match()
        }

    }

}