/* Basic configuration for the Bovine TB pipeline */

manifest {
	author = "Richard Ellis"
	homePage = "https://github.com/APHA-CSU/btb-seq"
    description = "This is the updated pipeline for APHA's processing of Mycobacterium bovis WGS data. This has been built to run using nextflow"
    mainScript = "main.nf"
}


plugins {
	id "nf-amazon"
}

profiles {
    standard {
        process.executor = "local"
	report.overwrite = true
	timeline.overwrite = true
	docker {
	    enabled = 'true'
	    fixOwnership = 'true'
	    runOptions = '--user "$(id -u):$(id -g)"'
	}
	cleanup = true
    }
    cloud {
	fusion {
	    enabled = true
	}
	wave {
	    enabled = true
	}
	process {
	    withName: deduplicate {
		executor = "awsbatch"
		cpus = 1
		memory = 2500.MB
		queue = "btb-seq"
		container = "982622767822.dkr.ecr.eu-west-1.amazonaws.com/btb-seq:deduplicate"
	    }
	    withName: trim {
		executor = "awsbatch"
		cpus = 2
		memory = 1500.MB
		queue = "btb-seq"
		container = "982622767822.dkr.ecr.eu-west-1.amazonaws.com/btb-seq:trim"
	    }
	    withName: map2Ref {
		executor = "awsbatch"
		cpus = 2
		memory = 2.GB
		queue = "btb-seq"
		container = "982622767822.dkr.ecr.eu-west-1.amazonaws.com/btb-seq:map_2_ref"
	    }
	    withName: varCall {
		executor = "awsbatch"
		cpus = 1
		memory = 150.MB
		queue = "btb-seq"
		container = "982622767822.dkr.ecr.eu-west-1.amazonaws.com/btb-seq:var_call"
	    }
	    withName: mask {
		executor = "awsbatch"
		cpus = 1
		memory = 150.MB
		queue = "btb-seq"
		container = "982622767822.dkr.ecr.eu-west-1.amazonaws.com/btb-seq:mask"
	    }
	    withName: readStats {
		executor = "awsbatch"
		cpus = 1
		memory = 50.MB
		queue = "btb-seq"
		container = "982622767822.dkr.ecr.eu-west-1.amazonaws.com/btb-seq:read_stats"
	    }
	    withName: vcf2Consensus {
		executor = "awsbatch"
		cpus = 1
		memory = 50.MB
		queue = "btb-seq"
		container = "982622767822.dkr.ecr.eu-west-1.amazonaws.com/btb-seq:vcf_2_consensus"
	    }
	    withName: assignCluster {
		executor = "awsbatch"
		cpus = 1
		memory = 50.MB
		queue = "btb-seq"
		container = "982622767822.dkr.ecr.eu-west-1.amazonaws.com/btb-seq:assign_clusters"
	    }
	    withName: idNonBovis {
		executor = "awsbatch"
		cpus = 2
		memory = 3.GB
		queue = "btb-seq"
		container = "982622767822.dkr.ecr.eu-west-1.amazonaws.com/btb-seq:id_non_bovis"
	    }
	    withName: combineOutput {
		executor = "awsbatch"
		cpus = 1
		memory = 50.MB
		queue = "btb-seq"
		container = "982622767822.dkr.ecr.eu-west-1.amazonaws.com/btb-seq:combine_output"
	    }
	}
        workDir = "s3://s3-hello-nextflow/nextflow_env/"
        aws.batch.cliPath = "/home/ec2-user/miniconda/bin/aws"
>>>>>>> batch-nextflow
        aws.region = "eu-west-1"
	report.overwrite = true
	timeline.overwrite = true
    }
}

/* location of reference information */

params.ref = "/BovTB-nf/references/Mycbovis-2122-97_LT708304.fas"
params.refgbk = "/BovTB-nf/references/Mycbovis-2122-97_LT708304.gb"
params.rptmask = "/BovTB-nf/references/DataDrivenMerge20.bed"
params.allsites = "/BovTB-nf/references/All-sites.bed"
params.stage1pat = "/BovTB-nf/references/Stage1_patterns/"
params.adapters = "/BovTB-nf/references/adapter.fasta"
params.discrimPos = "/BovTB-nf/references/DiscrimPos.tsv"

/* location of python scripts */

/* quality thresholds */
env.min_mean_cov = 8
env.min_cov_snp = 5
env.alt_prop_snp = 0.2
env.min_qual_snp = 150
env.min_qual_nonsnp = 0

/* quality thresholds (variant calling) */
params.MAP_QUAL = 0
params.BASE_QUAL = 10
params.PLOIDY = "1"

/* quality thresholds (snp filtering) */
params.MIN_READ_DEPTH = 8
params.MIN_ALLELE_FREQUENCY_ALT = 0.8
params.MIN_ALLELE_FREQUENCY_REF = 0.7

/* location of dependancies */

params.kraken2db = "/opt/Kraken2/db/minikraken2_v1_8GB/"
